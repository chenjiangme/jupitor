syntax = "proto3";

package jupitor.trading;

option go_package = "jupitor/internal/api/pb";

import "google/protobuf/timestamp.proto";

// Trading service handles order management and position tracking.
service Trading {
  // Submit a new order.
  rpc SubmitOrder(SubmitOrderRequest) returns (OrderResponse);

  // Cancel an existing order.
  rpc CancelOrder(CancelOrderRequest) returns (OrderResponse);

  // Get current positions.
  rpc GetPositions(GetPositionsRequest) returns (GetPositionsResponse);

  // Stream order status updates.
  rpc StreamOrders(StreamOrdersRequest) returns (stream OrderUpdate);

  // Get account information.
  rpc GetAccount(GetAccountRequest) returns (AccountInfo);
}

message SubmitOrderRequest {
  string symbol = 1;
  OrderSide side = 2;
  OrderType type = 3;
  TimeInForce time_in_force = 4;
  double qty = 5;
  double limit_price = 6;  // Required for limit orders
  double stop_price = 7;   // Required for stop orders
  string strategy_id = 8;  // Originating strategy
}

message CancelOrderRequest {
  string order_id = 1;
}

message OrderResponse {
  string order_id = 1;
  string status = 2;
  string message = 3;
}

message StreamOrdersRequest {
  // Empty: streams all order updates
}

message OrderUpdate {
  string order_id = 1;
  string symbol = 2;
  OrderSide side = 3;
  OrderType type = 4;
  string status = 5;
  double filled_qty = 6;
  double filled_avg_price = 7;
  google.protobuf.Timestamp timestamp = 8;
}

message GetPositionsRequest {
  // Empty: returns all positions
}

message GetPositionsResponse {
  repeated Position positions = 1;
}

message Position {
  string symbol = 1;
  double qty = 2;
  double avg_entry_price = 3;
  double market_value = 4;
  double unrealized_pl = 5;
  double unrealized_pl_pct = 6;
  OrderSide side = 7;
}

message GetAccountRequest {
  // Empty
}

message AccountInfo {
  double equity = 1;
  double cash = 2;
  double buying_power = 3;
  double portfolio_value = 4;
  double daily_pl = 5;
  double daily_pl_pct = 6;
}

enum OrderSide {
  ORDER_SIDE_UNSPECIFIED = 0;
  ORDER_SIDE_BUY = 1;
  ORDER_SIDE_SELL = 2;
}

enum OrderType {
  ORDER_TYPE_UNSPECIFIED = 0;
  ORDER_TYPE_MARKET = 1;
  ORDER_TYPE_LIMIT = 2;
  ORDER_TYPE_STOP = 3;
  ORDER_TYPE_STOP_LIMIT = 4;
}

enum TimeInForce {
  TIME_IN_FORCE_UNSPECIFIED = 0;
  TIME_IN_FORCE_DAY = 1;
  TIME_IN_FORCE_GTC = 2;
  TIME_IN_FORCE_IOC = 3;
  TIME_IN_FORCE_FOK = 4;
}
